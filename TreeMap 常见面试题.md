# TreeMap 常见面试题



## 红黑树的插入和删除

### 红黑树的 5 个性质

1. 根节点是黑色

2. 所有叶子节点都是黑色，且值为 NULL

3. 新插入的节点是红色

4. 从根节点到叶子节点的所有路径上不能出现两个连续的红色节点

5. 从任一节点到其每个叶子节点的所有路径上都包含相同数目的黑色节点

### 约定俗成的叫法

x：新插入的节点（ 也可以叫当前节点 ）

parentOf(x)：新插入的节点的**父亲节点**

parentOf(parentOf(x))：新插入的节点的**爷爷节点**

leftOf(parentOf(parentOf(x))) 或 rightOf(parentOf(parentOf(x)))：新插入的节点的**叔叔节点**

### 插入公式

循环的跳出条件 while (x != null && x != root && x.parent.color == RED) {...}

如果新插入节点的父亲节点是爷爷节点的左子树：

  * 如果叔叔节点是红色，则只需要将父亲节点和叔叔节点置为黑色，爷爷节点置为红色（ 如果爷爷节点为根节点，那么在跳出 while 循环后会将其再次置为黑色 ）；
  
  * 如果叔叔节点是黑色，
  
    * 如果新插入元素是父亲节点的**左子树**，则需要父亲节点置为黑色，爷爷节点置为红色，然后**右旋爷爷节点**；（ @1 ）
    
    * 如果新插入元素是父亲节点的**右子树**，则需要先**左旋父亲节点**，然后再执行 @1 的所有操作。
    
如果新插入节点的父亲节点是爷爷节点的右子树：

  * 如果叔叔节点是红色，则只需要将父亲节点和叔叔节点置为黑色，爷爷节点置为红色（ 如果爷爷节点为根节点，那么在跳出 while 循环后会将其再次置为黑色 ）；
  
  * 如果叔叔节点是黑色，
  
    * 如果新插入元素是父亲节点的**左子树**，则需要先**右旋父亲节点**，然后再执行 @2 的所有操作。
    
    * 如果新插入元素是父亲节点的**右子树**，则需要父亲节点置为黑色，爷爷节点置为红色，然后**左旋爷爷节点**；（ @2 ）

背诵技巧：

* 无论父亲节点是爷爷节点的左子树还是右子树，只要叔叔节点是红色，就不涉及复杂的旋转操作。

* 如果爷爷节点、父亲节点和新插入节点无法构成**三点一线**，则需要先反方向旋转一次父亲节点后再修改节点颜色以及后续旋转爷爷节点。
